<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>BLE PID Controller</title>
</head>
<body>
  <h1>BLE PID Sender (V1)</h1>
  
  <label>Kp: <input type="number" id="kp" value="60"></label><br>
  <label>Ki: <input type="number" id="ki" value="270"></label><br>
  <label>Kd: <input type="number" id="kd" value="2.2"></label><br>
  <button onclick="sendPID()">Send PID</button><br><br>

  <button onclick="connectBLE()">Connect to Robot</button>

  <h3>Status: <span id="status">Disconnected</span></h3>

  <script>
    let device, characteristic;
    const serviceUUID = '19b10000-e8f2-537e-4f6c-d104768a1214';
    const charUUID = '19b10001-e8f2-537e-4f6c-d104768a1214';

    async function connectBLE() {
      try {
        device = await navigator.bluetooth.requestDevice({
          filters: [{ services: [serviceUUID] }]
        });
        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(serviceUUID);
        characteristic = await service.getCharacteristic(charUUID);
        document.getElementById('status').innerText = 'Connected';
        console.log('Connected to robot');
      } catch (error) {
        console.error(error);
        document.getElementById('status').innerText = 'Connection failed';
      }
    }

    function sendPID() {
      if (!characteristic) {
        alert("Not connected!");
        return;
      }
      const kp = document.getElementById("kp").value;
      const ki = document.getElementById("ki").value;
      const kd = document.getElementById("kd").value;
      const data = `${kp},${ki},${kd}`;
      characteristic.writeValue(new TextEncoder().encode(data));
      console.log("Sent PID:", data);
    }
  </script>
</body>
</html>
